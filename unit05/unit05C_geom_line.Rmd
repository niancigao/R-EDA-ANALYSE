---
title: åœ¨æŠ˜ç·šåœ–ä¸­æ¯”è¼ƒè¶¨å‹¢
author: Tony Chuo, NSYSU
date: "`r Sys.time()`"
output: 
  html_document: 
    theme: spacelab
    highlight: pygments
    css: ../etc/style.css
editor_options: 
  chunk_output_type: console
---

```{r echo=F, results='hide', message=FALSE, warning=FALSE}
# å®‰è£ã€è¨­å®šå’Œæ ¼å¼åŒ–ã€‚ä¸è¦ä¿®æ”¹æ­¤ç¨‹å¼å€å¡Šã€‚  
rm(list=ls(all=T))
knitr::opts_chunk$set(comment = NA)
knitr::opts_knit$set(global.par = TRUE) 
options(scipen=20, digits=4, width=80, tibble.print_min=4)
# rmarkdown::find_pandoc(version = '2.7.3')
```

<br><br><p class="wwl"><span style='font-size:24px'> ğŸ  </span>
<span style='font-size:14px; font-family:"Arial Black"'>
<b><u>é‡é»æè¦ :</u></b></span><br>
&emsp; â–  ç”¨æŠ˜ç·šåœ–ä¾†è§€å¯Ÿè¶¨å‹¢<br>
&emsp; â–  é€šéç®¡é“ç¬¦è™Ÿ(pipeline)ä»¥é€£æ¥ `dplyr` å’Œ `ggplot`<br>
&emsp; â–  åŒæ™‚å¾å„å€‹é¢å‘æ¯”è¼ƒè¶¨å‹¢<br>
</p class="wwl"><br>

è¼‰å…¥libraryè£¡é¢çš„å¥—ä»¶ä¸¦è¼‰å…¥comicsæ•¸æ“šé›†
```{r message=FALSE, warning=FALSE}
pacman::p_load(dplyr,tidyr,ggplot2,plotly,gridExtra)
theme_set(theme_get() + theme(
  text=element_text(size=8), legend.key.size=unit(10,"points")
  ))
D = read.csv("data/comics1.csv",stringsAsFactors=F) %>% as_tibble
```

<br>

### 1. ç°¡å–®æŠ˜ç·šåœ–

è®“æˆ‘å€‘è¨ˆç®—ä¸¦ç¹ªåœ–è§€å¯Ÿæ¯å¹´é¦–æ¬¡äº®ç›¸çš„æ–°è§’è‰²æ•¸é‡ã€‚
```{r fig.height=2, fig.width=5}
count(D, year) %>%                    # è¨ˆç®—æ¯å¹´æ–°è§’è‰²çš„æ•¸é‡
  ggplot(aes(year, n)) + geom_line()  # ä¸¦ç¹ªè£½ä¸€å€‹æŠ˜ç·šåœ–
```

`count()` å’Œ `ggplot() + geom_line()` æ˜¯ä¸€å€‹éå¸¸æ–¹ä¾¿çš„çµ„åˆã€‚æˆ‘å€‘å¯ä»¥é€šéä¸€å€‹é¡å¤–çš„é¡åˆ¥è®Šæ•¸`publisher`ä¾†æ¯”è¼ƒDCå’ŒMarvelæ¯å¹´æ–°è§’è‰²æ•¸é‡çš„çš„è®ŠåŒ–è¶¨å‹¢ã€‚

```{r fig.height=2, fig.width=5}
count(D, year, publisher) %>%                    
  ggplot(aes(year, n, col=publisher)) + 
  geom_line(size=1)
```

##### 1.1 æ¶ˆé™¤æ³¢å‹•çš„è¶¨å‹¢ç·š

è§€å¯Ÿé•·æœŸè¶¨å‹¢çš„æ™‚å€™ï¼Œå¦‚æœè¶¨å‹¢ç·šçœ‹èµ·ä¾†æ³¢å‹•å¤ªå¤§ï¼Œæˆ‘å€‘å¯ä»¥å¢åŠ æ¸¬é‡é€±æœŸï¼Œè³‡æ–™åˆä½µé€šå¸¸æœ‰åŠ©æ–¼æŠµæ¶ˆéš¨æ©Ÿèª¤å·®ï¼Œè®“è¶¨å‹¢ç·šè®Šå¾—æ¯”è¼ƒå¹³æ»‘ï¼›ç”±æ–¼DCåœ¨1980å¹´ä¹‹å‰ä¸æ´»èºï¼Œæ‰€ä»¥æˆ‘å€‘ï¼š

+ éæ¿¾æ‰1980å¹´ä¹‹å‰å’Œ2010å¹´ä¹‹å¾Œçš„æ•¸æ“š
+ å°‡30å¹´åˆ†ç‚º6å€‹æœŸé–“(period)

```{r}
breaks=seq(1980,2010,5)
D2 = filter(D, year>=1980, year<=2010) %>%  
  mutate(period = cut(year,breaks,breaks[-1],T) %>% 
           as.character %>% as.integer)
table(D2$period, useNA='ifany')  # ç´å…¥ç¼ºå¤±å€¼
```

```{r fig.height=1.8, fig.width=5}
ggplot(D2, aes(period, fill=publisher)) + 
  geom_bar(position='dodge')
```

åƒé€™æ¨£é€šéæ¢ç‹€åœ–ä¾†åˆ¤æ–·é•·æœŸè¶¨å‹¢è¦å®¹æ˜“å¾—å¤šï¼Œä¸æ˜¯å—?

å¾ä¸Šåœ–æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼Œæ¼«ç•«ç”¢æ¥­åœ¨2000å¹´ç¶“æ­·ä¸€å€‹ä½è°·ä¹‹å¾Œï¼ŒMarvelä¼¼ä¹æ¯”DCæ›´æ—©ã€æ›´å¼·å‹åœ°åå½ˆå›ä¾†ã€‚

<br><br>


### 2. å¤šæ–¹é¢æ¯”è¼ƒè¶¨å‹¢ 

çµåˆ `dplyr` å’Œ `ggplot`çš„å¼·å¤§åŠŸèƒ½ï¼Œæˆ‘å€‘å¯ä»¥ä¸€æ¬¡æ¯”è¼ƒå¤šå€‹æ–¹é¢çš„è¶¨å‹¢ã€‚è®“æˆ‘å€‘å¾ä¸€å€‹ç°¡å–®çš„åœ–é–‹å§‹ï¼Œè©²åœ–è¦–è¦ºåŒ–äº†æ¯å€‹(å¥½äºº/å£äºº/ä¸­ç«‹)é™£ç‡Ÿçš„æ¯”ç‡å¦‚ä½•è®ŠåŒ–ã€‚

```{r fig.height=1.6, fig.width=3.2}
count(D2, period, align) %>% 
  group_by(period) %>% 
  mutate(rate = n/sum(n)) %>% 
  ggplot(aes(period, rate)) + 
  geom_line(aes(col=align))
```

é€™ä¸€å€‹è¶¨å‹¢æ˜¯å¦å› å‡ºç‰ˆå•†è€Œç•°å‘¢ï¼Ÿ

```{r fig.height=1.8, fig.width=4.8}
count(D2, period, publisher, align) %>%  # ä»¥é¡åˆ¥å‹è®Šæ•¸è¨ˆç®—å€‹æ•¸
  group_by(period, publisher) %>%        # æ ¹æ“šperiodå’Œpublisherä¾†å°è³‡æ–™é€²è¡Œåˆ†çµ„
  mutate(rate = n/sum(n)) %>%            # æ–°å¢ä¸€å€‹æ¬„ä½rateä¸¦å°‡è¨ˆç®—çš„å€‹æ•¸è½‰æ›ç‚ºæ¯”ç‡
  ggplot(aes(period, rate)) + 
  facet_grid(~publisher) +               # æ¯ä¸€å€‹å‡ºç‰ˆå•†ä¸€å€‹ç¹ªåœ–å€å¡Š(produce 1 panel per publisher)
  geom_line(aes(col=align), size=1) +    # ä½¿ç·šæ¢æ›´ç²—
  geom_point()                           # å¢åŠ åœ“é»ä½¿å…¶çœ‹èµ·ä¾†æ›´å¥½
```

<br>

<span style='font-size:14px; font-family:"Arial Black"'>
<b><u>ğŸš´ **ç·´ç¿’ï¼š**</u></b></span><br>
è®“æˆ‘å€‘å˜—è©¦ä»¥å‡ºç‰ˆå•†å’Œæ€§åˆ¥ä¾†æ¯”è¼ƒ(å¥½äºº/å£äºº/ä¸­ç«‹)é™£ç‡Ÿçš„è¶¨å‹¢ã€‚æ­£å¦‚ä¸‹é¢çš„åœ–è¡¨ä¸­çœ‹åˆ°çš„ï¼Œåœ¨4å€‹å–®ç¨çš„ç¹ªåœ–å€å¡Šä¸­æœ‰4å€‹æ¨¡å¼(there'd be 4 patterns in 4 separate panels.)ã€‚ä½ å¯ä»¥é€šéä¿®æ”¹ç¨‹å¼å€å¡Šä¾†è£½ä½œä¸‹é¢çš„åœ–è¡¨å—ï¼Ÿ

```{r fig.height=3, fig.width=5}
# count(D2, period, publisher, align) %>%  
#   group_by(period, publisher) %>%        
#   mutate(rate = n/sum(n)) %>%            
#   ggplot(aes(period, rate)) + 
#   facet_grid(sex~publisher) +            # æ¯ä¸€å€‹ç¹ªåœ–å€å¡Šå„ä¸€å€‹å‡ºç‰ˆå•†èˆ‡æ€§åˆ¥(1 panel per publisher per sex)
#   geom_line(aes(col=align), size=1) +    
#   geom_point()                           
```

```{r fig.height=3, fig.width=5}
count(D2, period, publisher, sex, align) %>%  
  group_by(period, publisher, sex) %>%        
  mutate(rate = n/sum(n)) %>%            
  ggplot(aes(period, rate)) + 
  facet_grid(sex~publisher) +            
  geom_line(aes(col=align), size=1) +    
  geom_point()                           
```


<br><br>







