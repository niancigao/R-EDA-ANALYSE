---
title: UNIT07B：離散機率的應用案例
author: 中山大學管理學院 卓雍然
date: "`r Sys.time()`"
output: 
  html_document:
    highlight: pygments
    theme: flatly
    css: ../etc/style.css
---

```{r results='hide', message=FALSE, warning=FALSE, echo=F}
# 這些程式碼設定網頁的格式，並安裝、載入一些基本的套件，請大家不要去改動<br>
rm(list=ls(all=T))
knitr::opts_chunk$set(comment = NA)
knitr::opts_knit$set(global.par = TRUE)
par(cex=0.8)
options(scipen=20, digits=5, width=80)
if(!require(pacman)) install.packages("pacman")
if(!require(vcd)) install.packages("vcd")
```

<p class="wwl">
<span style="font-size:20px">`r "\U1F4A1"` 學習重點：離散機率的定義</span><br>
&emsp; ■ `Binomial[n, p]`: 重複發生機率為`p`的實驗`n`次，其發生次數的分佈<br>
&emsp; ■ `Geomtric[p]`: 重複發生機率為`p`的實驗，第一次發生前失敗次數的分佈<br>
&emsp; ■ `NBinomial[n, p]`: 重複發生機率為`p`的實驗，第`n`次發生前失敗次數的分佈<br>
&emsp; ■ `Poisson[`$\lambda$`]`: 期望值為$\lambda$的小機率事件發生次數的分佈<br>
</p class="wwl">
<hr>

```{r}
pacman::p_load(dplyr, vcd)
```

### 【1】被馬踢死 Death by Horse Kick
**資料** `HorseKick`:每一個軍團、每年被馬踢死的人數
```{r}
par(mfrow=c(1,1), cex=0.7)
HorseKicks
```

**檢定**：這一份數據符合Poisson分佈嗎？
```{r}
fit = goodfit(HorseKicks, type = "poisson")
summary(fit)
# H0:沒有顯著差異
```
`p=0.833`：數據與Poisson沒有顯著差異 


**係數**：What is the $\lambda$?
```{r}
fit$par #參數
```

**應用**：`nDeath >= 2` 的機率是？
```{r}
1 - ppois(1, fit$par$lambda) #到1的機率 
```
<br>

<p class="qiz">
<span style="font-size:24px">`r "\U1F9D9"` 問題討論：</span><br>
如果保險公司想要為國防部設計一個被馬踢死的保險：<br>
&emsp; ■ 如果你只要只靠`HorseKick`這一份數據，每一軍團每年被馬踢死的次數超過5次的機率是多？ 不知道<br>
&emsp; ■ 如果我們將數據fit到理論分布上面，根據理論分佈，被馬踢死的次數超過5次的機率是多？<br>
&emsp; ■ 妳想要計算風險成本的話，以上哪一種做法比較合理呢？ 第2種<br>
</p class="qiz">

What is the probability of `nDeath >= 5`?
```{r}
1 - ppois(4, fit$par$lambda)  
```
```{r}
ppois(6, fit$par$lambda) - ppois(2, fit$par$lambda)  #被馬踢死的人數大於等於3小於等於6的機率
dpois(3,fit$par$lambda)+dpois(4,fit$par$lambda)+dpois(5,fit$par$lambda)+dpois(6,fit$par$lambda)
dpois(3:6,fit$par$lambda) %>% sum

```

```{r}
1-(dpois(0,fit$par$lambda)+dpois(1,fit$par$lambda)+dpois(2,fit$par$lambda)+dpois(3,fit$par$lambda)+dpois(4,fit$par$lambda))

```
<br><br><hr>

### 【2】"May" in Federalist Papers
**資料** `Federalist`：某份聯邦文件中，每一個段落出現"may"這個字的次數 
```{r}
Federalist
```

**檢定**：這一份數據符合Poisson分佈嗎？
```{r}
fit <- goodfit(Federalist, type = "poisson") #NO
summary(fit)
```

它符合負二項(Negtive Binomial)分佈嗎？
```{r}
fit = goodfit(Federalist, type = "nbinomial") #YES
summary(fit)
```

**係數**：負二項(Negtive Binomial)的係數是？
```{r}
fit$par
```

**分佈**：How does the distribution looks like?
```{r fig.height=3, fig.width=7.5}
par=c(margin=c(3,3,3,1),cex=0.7)
dnbinom(0:10, fit$par$size, fit$par$prob) %>% barplot(names=0:10)
```

**機率**：What is the probability that `2 <= nMay <= 6`?
```{r}
pnbinom(6,fit$par$size,fit$par$prob)-pnbinom(1,fit$par$size,fit$par$prob)
```
<br><br><hr>


<p class="wwl">
<span style="font-size:20px">`r "\U1F4A1"` 
學習重點：離散機率的應用步驟</span><br>
&emsp; 1. 檢定分佈的種類<br>
&emsp; 2. 估計分佈的參數<br>
&emsp; 3. 推論事件的機率<br>
</p class="wwl">

<br><br>




