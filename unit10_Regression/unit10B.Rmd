---
title: UNIT10Bï¼šç°¡å–®ç·šæ€§å›æ­¸ Simple Linear Regression
author: ä¸­å±±å¤§å­¸ç®¡ç†å­¸é™¢ å“é›ç„¶
date: "`r Sys.time()`"
output: 
  html_document:
    highlight: pygments
    theme: flatly
    css: ../etc/style.css
---

```{r results='hide', message=FALSE, warning=FALSE, echo=F}
# Formating Codes.  Do not change the codes in this chunk.<br>
# rm(list=ls(all=T))
knitr::opts_chunk$set(comment = NA)
knitr::opts_knit$set(global.par = TRUE)
par(cex=0.8)
options(scipen=20, digits=5, width=80)
if(!require(pacman)) install.packages("pacman")
```
<hr>

```{r results='hide', message=FALSE, warning=FALSE}
pacman::p_load(dplyr, ggplot2, plotly, ggpubr)
```

æ‰¹ç™¼å•†è³‡æ–™é›†
```{r}
W = read.csv('data/wholesales.csv')
W$Channel = factor( paste0("Ch",W$Channel) )
W$Region = factor( paste0("Reg",W$Region) )
W[3:8] = lapply(W[3:8], log, base=10)
```
<br><hr>

### [A] ç”¨Råšç·šæ€§å›æ­¸ 

+ `lm` : æ–¹æ³•
+ `md` : æ¨¡å‹
+ `Milk` : ç›®æ¨™è®Šæ•¸ Response, Dependent Variable (DV)
+ `Grocery` : é æ¸¬è®Šæ•¸ Predictor, Independent Variable (IV)
+ `W` : è³‡æ–™

```{r}
md = lm(Milk ~ Grocery, W) # y ~ x1+x2+...
```

```{r}
names(md)
```
<br><hr>

### [B] ç†è«– vs å¯¦è­‰æ¨¡å‹

+ ç†è«–æ¨¡å‹ï¼š$y_i = \beta_0 + \beta_1 x_i + \epsilon_i, \; \epsilon \in i.i.d.\;Normal\;Dist.$
    + $\beta_0$, $\beta_1$ - ä¿‚æ•¸
    + $y_i$ - ç›®æ¨™è®Šæ•¸
    + $x_i$ - é æ¸¬è®Šæ•¸
    + $\epsilon_i$ - èª¤å·® 

+ æ¨¡å‹ä¼°è¨ˆ/é æ¸¬ï¼š$\hat{y}_i = b_0 + b_1 x_i$
    + `md$coefficient` : $b_0$, $b_1$ - ä¿‚æ•¸ä¼°è¨ˆå€¼
    + `md$fitted.value` : $\hat{y}_i$ - ç›®æ¨™è®Šæ•¸ä¼°è¨ˆå€¼
    + `md$residuals` : $e_i = y - \hat{y}$ - æ®˜å·® 

```{r}
y = W$Milk                # ç›®æ¨™è®Šæ•¸
x = W$Grocery             # è§£é‡‹è®Šæ•¸
b0 = md$coef[1]           # æˆªè·
b1 = md$coef[2]           # æ–œç‡
yhat = b0 + b1 * x        # é æ¸¬å€¼
er = y - yhat             # æ®˜å·® (Residual)
```

```{r}
range(yhat - md$fitted.values)

# é æ¸¬å€¼(b0+b1*x)è·Ÿç›®æ¨™è®Šæ•¸ä¼°è¨ˆå€¼(md$fitted.value) ä¸€æ¨£

```

```{r}
range(er - md$residuals)

# æ®˜å·®(er)è·Ÿæ®˜å·®(md$residuals)ä¸€æ¨£

```
<br><hr>

### [C] ç•«å‡ºå›æ­¸ç·š

$$ Milk_i = b_0 + b_1 Grocery_i$$

```{r fig.height=3.2, fig.width=3.2}
par(cex=0.8, mar=c(4,4,1,1))
plot(W$Grocery, W$Milk, pch=20, col="#80808080")
abline(b0, b1, col='red') # æˆªè·ã€æ–œç‡

# pch=20ï¼Œé»çš„å½¢ç‹€

```

```{r fig.height=3.7, fig.width=3.5}
ggplot(aes(Grocery, Milk), data=W) + 
  geom_point(alpha=0.4, size=0.8) + 
  geom_smooth(formula=y ~ x, method="lm", level=0.95, lwd=0.2) + 
  theme_bw() -> p

# level=0.95,ä¿¡è³´å€é–“ã€lwd=0.2,ç·šç²—ç´°

ggplotly(p)

```

ğŸŒ» **å•é¡Œ**

+ ç‚ºä»€éº¼å¤§éƒ¨åˆ†çš„è³‡æ–™é»éƒ½æ²’æœ‰è½åœ¨95%ä¿¡å¿ƒå€é–“å‘¢ï¼Ÿ
+ (ä¿¡è³´å€é–“è·Ÿé æ¸¬å€é–“çš„å·®åˆ¥)
+ æ¨¡å‹ä¼°è¨ˆçš„æ˜¯$y$çš„å¹³å‡å€¼($\bar{y}|x$)ã€è€Œä¸æ˜¯$y$æœ¬èº«ï¼

<br><hr>

### [D] ä½¿ç”¨æ¨¡å‹åšé æ¸¬(ä¼°è¨ˆ)
```{r}
new_data = tibble(Grocery = seq(1,5,0.5))
new_data
```

ğŸŒ» $\hat y$ çš„ **ä¿¡è³´å€é–“(Confidence Interval)**
```{r}
conf = predict(md, new_data, interval="confidence"); conf

# md:æ¨¡å‹
# new_data:è¦é æ¸¬çš„x
# interval = "confidence" :çµ¦ä¿¡è³´å€é–“ï¼Œçµ¦çš„æ˜¯yçš„å¹³å‡å€¼çš„ç¯„åœï¼Œè€Œä¸æ˜¯yæœ¬èº«

```

ğŸŒ» $y$ çš„ **é æ¸¬å€é–“(Prediction Interval)**
```{r}
pred = predict(md, new_data, interval="prediction"); pred

# md:æ¨¡å‹
# new_data:è¦é æ¸¬çš„x
# interval = "prediction" :çµ¦é æ¸¬å€é–“ï¼Œçµ¦çš„æ˜¯yæœ¬èº«é æ¸¬å‡ºä¾†çš„å€¼

```

```{r}
df = cbind(new_data,conf,pred[,-1]) 
names(df) = c("x","yhat","c.lwr","c.upr","p.lwr","p.upr")
df
```

```{r fig.height=3.7, fig.width=3.5, warning=F}
ggplot(df, aes(x)) +
  geom_point(aes(y=yhat),col='red',size=2) +
  geom_line(aes(y=yhat),col='red') +
  geom_line(aes(y=c.lwr),col='orange') +
  geom_line(aes(y=c.upr),col='orange') +
  geom_line(aes(y=p.lwr),col='magenta',linetype='dashed') +
  geom_line(aes(y=p.upr),col='magenta',linetype='dashed') +
  geom_point(data=W, aes(x=Grocery, y=Milk), size=0.8, alpha=0.5) +
  xlim(1,5) + ylim(1,5) + theme_bw()

# ç´…ç·š:å›æ­¸ç·š
# ç´…é»:çµ¦xå¾Œçš„é»ä¼°è¨ˆ
# æ©˜ç·š:ä¿¡è³´å€é–“(æ‰€æœ‰yçš„å¹³å‡å€¼è½åœ¨çš„å€é–“)
# ç²‰ç·š:é æ¸¬å€é–“(çµ¦xå¾Œ95%ä¿¡å¿ƒä¸€å®šè½åœ¨çš„å€é–“)

```

ğŸŒ» **95%é æ¸¬å€é–“(Prediction Interval)**æ‰æœƒæ¶µè“‹95%çš„$y$

<br>

### [E] æ¨¡å‹æ‘˜è¦åŠŸèƒ½
```{r}
summary(md)
```

##### Â§ æ¨¡å‹çš„æº–ç¢ºæ€§

+ Residual standard error: æ®˜å·®çš„æ¨™æº–å·® (~èª¤å·®çš„å¹³å‡å€¼)
+ R-squared: æ¨¡å‹æ‰€èƒ½è§£é‡‹çš„(ç›®æ¨™è®Šæ•¸çš„)è®Šç•°æ¯”ç‡

<span style="font-size:24px"> `r "\U1F4A1"` : </span>
$b_1$ ä¿‚æ•¸ä»£è¡¨å¹³å‡è€Œè¨€ï¼Œ $x$ æ¯å¢åŠ ä¸€å–®ä½æ™‚ï¼Œ$y$ æœƒå¢åŠ çš„æ•¸é‡

+ Coefficients:
    + Estimate: ä¿‚æ•¸ä¼°è¨ˆå€¼
    + Std. Error: ä¿‚æ•¸ä¼°è¨ˆå€¼çš„æ¨™æº–å·®
    + Pr(>|t|): $p$å€¼ (è®Šæ•¸ä¹‹é–“æ²’æœ‰é—œä¿‚çš„æ©Ÿç‡ï¼Ÿ)
    + Signif. codes: é¡¯è‘—æ¨™è¨˜

<br>

##### Â§ ä¿‚æ•¸çš„åˆ†å¸ƒ
```{r fig.height=3.2, fig.width=7.2}
curve(dnorm(x, 0.7352, 0.0301), from=-0.1, to=1, n=400, xlab=bquote(italic(b[1])),
      main=bquote("The Distribution of Random Variable: " ~ italic(b[1])))
abline(v=qnorm(c(0.025, 0.975),0.7352, 0.0301), col="red")

# x = W$Groceryï¼Œ440å€‹
# xlab = xè»¸æ¨™ç±¤, ylab = yè»¸æ¨™ç±¤
# bquote:å ±åƒ¹ï¼›italic:æ–œé«”
# bquote:å‰µå»ºå…·æœ‰æ··åˆ(1)å­—ç¬¦ä¸²(2)è¡¨é”å¼(3)æ•¸å­—çš„è¡¨é”å¼ï¼Œç”¨~é€£æ¥

```

<span style="font-size:24px"> `r "\U1F4A1"` : </span>
ä¿‚æ•¸($b_0, b_1$)ä¹Ÿéƒ½æ˜¯éš¨æ©Ÿè®Šæ•¸ï¼Œä»–å€‘éƒ½æœƒæœ‰ï¼š

+ é»ä¼°è¨ˆï¼šæœŸæœ›å€¼ã€æœ€æœ‰å¯èƒ½çš„å€¼
+ å€é–“ä¼°è¨ˆï¼šæŸä¸€ä¿¡å¿ƒæ°´æº–ä¹‹ä¸‹ä¼°è¨ˆå€¼å¯èƒ½å‡ºç¾çš„å€é–“

<br><br><br><hr>



