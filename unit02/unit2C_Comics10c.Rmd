---
title: UNIT2Cï¼šComics Dataset (1)
author: ä¸­å±±å¤§å­¸ç®¡ç†å­¸é™¢ å“é›ç„¶
date: "`r Sys.time()`"
output: 
  html_document:
    highlight: pygments
    theme: flatly
    css: ../etc/style.css
---

```{r echo=F, results='hide', message=FALSE, warning=FALSE}
# Basic installation, setup & formatting.  Do not modify this code chunk.  
rm(list=ls(all=T))
knitr::opts_chunk$set(comment = NA)
knitr::opts_knit$set(global.par = TRUE)
par(cex=0.8); options(scipen=20, digits=4, width=80)
if(!require(pacman)) install.packages("pacman")
pacman::p_load(magrittr)
```
<br>

<center>
![DC and Marvel](fig/dc-marvel-1200.jpg){height=300}
</center><br>


åœ¨ç¹¼çºŒä¹‹å‰ï¼Œletâ€™s have some fun! åœ¨é€™ç¨‹å¼ç­†è¨˜ä¸­ï¼Œæˆ‘å€‘å°‡ä½¿ç”¨æ¼«ç•«äººç‰©çš„è³‡æ–™é›†ä¾†å›é¡§ã€ä»‹ç´¹å’Œç·´ç¿’ R çš„å…§å»ºå‡½æ•¸ã€‚  ( [è³‡æ–™ä¾†æº: Kaggle.com](https://www.kaggle.com/fivethirtyeight/fivethirtyeight-comic-characters-dataset) )

<br><br><hr>

###  1. è®€å…¥ä¸¦æª¢æŸ¥è³‡æ–™æ¡†çš„çµæ§‹

ğŸŒ» `read.csv()` - è®€å–CSVï¼ˆé€—è™Ÿåˆ†éš”å€¼ï¼‰çš„æ–‡ä»¶
```{r}
D = read.csv("data/comics1.csv")
```

ğŸŒ» `nrow()` - ç¢ºèªrowçš„æ•¸é‡ 

```{r}
nrow(D)
```

ğŸŒ» `ncol()` - ç¢ºèªcolumnçš„æ•¸é‡ 
```{r}
ncol(D)
```

è³‡æ–™æ¡†ä¹‹ä¸­ ...

+ ä¸€å€‹`row`åˆç¨±ç‚ºä¸€ç­†è³‡æ–™æˆ–ä¸€ç­†ç´€éŒ„(record)ï¼Œå®ƒä»£è¡¨ä¸€å€‹ç ”ç©¶å°è±¡ã€ä¸€å€‹åˆ†æå–®ä½
+ ä¸€å€‹`column`åˆç¨±ç‚ºä¸€å€‹æ¬„ä½ã€è®Šæ•¸(variables)æˆ–å±¬æ€§(attributes)ï¼Œå®ƒä»£è¡¨ç ”ç©¶å°è±¡çš„æŸå€‹å±¬æ€§æˆ–é‡æ¸¬å€¼

<br>

ğŸŒ» `str()` - ç”¨ä¾†æª¢æŸ¥è³‡æ–™æ¡†çš„çµæ§‹ï¼Œæ¯å€‹columnçš„è³‡æ–™ç¨®é¡
```{r}
str(D)
```
<br><hr>

###  2. æª¢æŸ¥è®Šæ•¸ 

ğŸŒ» `summary()` æ˜¯æª¢æŸ¥è³‡æ–™æ¡†(æ¯å€‹columnçš„)å…§å®¹æœ€æ–¹ä¾¿çš„æ–¹å¼
```{r}
summary(D)
```

<p class="qiz">
<span style="font-size:20px">`r "\U1F5FF"` QUIZ 2ï¼š</span><br>
&emsp; â–  é€™å€‹è³‡æ–™æ¡†çš„åå­—æ˜¯ä»€éº¼?<br>
&emsp; â–  æˆ‘å€‘è¦åˆ†æçš„ç›®æ¨™å°è±¡æ˜¯ä»€éº¼?<br>
&emsp; â–  æˆ‘å€‘æ„Ÿèˆˆè¶£çš„å±¬æ€§æ˜¯å“ªäº›?<br>
&emsp; â–  è³‡æ–™é›†æœ‰å“ªäº›æ˜¯æ•¸å€¼å‹çš„column ?<br>
&emsp; â–  è³‡æ–™é›†æœ‰å“ªäº›æ˜¯å­—ä¸²å‹çš„column ?<br>
&emsp; â–  å“ªäº›æ˜¯å­—ä¸²å‹çš„columnæ˜¯**é¡åˆ¥** æ¬„ä½å‘¢?<br>

```{r}
# D
# name (è§’è‰²)
# All variable
# appearances & year
# name (åŠ ä¸Šä¸‹é¢å¯è½‰é¡åˆ¥çš„è®Šæ•¸)
# align & eye & hair & alive & publisher & sex
```

</p class="qiz"><br>

ğŸŒ· è«‹æ³¨æ„ï¼Œå°ä¸åŒè³‡æ–™ç¨®é¡çš„æ¬„ä½ï¼Œ`summary()`æœƒä»¥ä¸åŒçš„æ–¹å¼é€²è¡ŒåŒ¯ç¸½

+ å°æ–¼**æ•¸å€¼**æ¬„ä½ï¼Œæœƒä»¥**çµ±è¨ˆé‡**çš„æ–¹å¼å›å ±è©²è®Šæ•¸çš„**åˆ†ä½ˆ**
+ å°æ–¼**å­—ä¸²**æ¬„ä½ï¼Œåªé¡¯ç¤ºå®ƒå€‘çš„ç¨®é¡
+ å°æ–¼**é¡åˆ¥**æ¬„ä½ï¼Œæœƒé¡¯ç¤ºå„é¡åˆ¥çš„åˆ†ä½ˆ (å¾Œé¢æœƒè©³ç´°èªªæ˜)
<br><br>

<p class="wwl">
<span style="font-size:18px">`r "\U1F4A1"` åˆ†ä½ˆ & çµ±è¨ˆé‡</span><br>
â–  **åˆ†ä½ˆ** : æ˜¯ä¸€ç¨®æè¿°è®Šæ•¸çš„æ–¹å¼ï¼Œå®ƒæè¿°è‘— ...<br>
&emsp; â—‡  è®Šæ•¸å€¼çš„è®ŠåŒ–<br>
&emsp; â—‡  ä¹Ÿå°±æ˜¯èªªï¼Œè®Šæ•¸çš„å€¼æ˜¯å¦‚ä½•åˆ†ä½ˆçš„?<br>
â–  **çµ±è¨ˆé‡** : æ•¸å€¼è®Šæ•¸çš„æŸç¨®å…·é«”ç‰¹å¾µ<br>
&emsp; â—‡  èˆ‰ä¾‹ä¾†èªª: å¹³å‡(mean), ä¸­ä½æ•¸(median), æœ€å°å€¼(min), æœ€å¤§å€¼(max)<br>
â–  è®Šæ•¸çš„åˆ†ä½ˆå¯ä»¥ç”¨å…©ç¨®å‹å¼è¡¨ç¤º :<br>
&emsp; â—‡  åœ¨æ•¸å­—ä¸Šï¼Œ ç”¨çµ±è¨ˆé‡è¡¨ç¤º æˆ–è€…<br>
&emsp; â—‡  ä»¥åœ–å½¢ä¸Šï¼Œç”¨ç¹ªåœ–çš„æ–¹å¼è¡¨ç¤º<br>
</p class="wwl"><br><br>

##### 2.1 æª¢æŸ¥æ•¸å€¼(é€£çºŒ)è®Šæ•¸

ğŸŒ» `mean()`, `median`, `max`, `min()` - å–å¾—æ•¸å€¼è®Šæ•¸çš„å€‹åˆ¥çµ±è¨ˆé‡
```{r}
c( mean=mean(D$year), median=median(D$year), 
   max=max(D$year), min=min(D$year)  )
```

ğŸŒ» `summary` ä¸€æ¬¡ç²å¾—æ‰€æœ‰ä¸»è¦çš„çµ±è¨ˆé‡
```{r}
summary(D$year)
```


ğŸŒ» `hist()` - ç•«å‡ºæ•¸å€¼è®Šæ•¸çš„åˆ†ä½ˆ<br>
ğŸŒ» `log()` ç•¶åˆ†ä½ˆå¾ˆä¸å‡å‹»æ™‚ï¼Œå°æ•¸å‡½æ•¸æœ‰åŠ©æ–¼å£“åˆ¶æ¥µç«¯å€¼çš„è¦–è¦ºè¡æ“Š
```{r fig.height=1.8, fig.width=6}
par(mfrow=c(1,2), mar=c(2,2,3,2), cex=0.6)  # 2 plots in a row, smaller font
hist(D$year, main="year")
hist(D$appearances, main="appearances")

log(D$appearances,10) %>% hist(main="log(appear.)")
#å‡ºç¾1ã€10ã€100ã€1000æ¬¡
```
<br><br>

##### 2.2 æª¢æŸ¥é¡åˆ¥(é›¢æ•£å‹)è®Šæ•¸

ğŸŒ» `table()` åˆ—å‡ºä¸¦å„é¡åˆ¥çš„å€‹æ•¸
```{r}
table(D$align)
```
è«‹æ³¨æ„ï¼Œå®ƒæ˜¯ä¾é¡åˆ¥åç¨±çš„å­—æ¯é †åºæ’åˆ—<br> 

ğŸŒ» `barplot()` è¦–è¦ºåŒ–é›¢æ•£è®Šæ•¸çš„åˆ†ä½ˆ
```{r fig.height=1.8, fig.width=4}
par(mfrow=c(1,1), cex=0.6)  # 1 plots in a row
table(D$align) %>% barplot(main="align")
```

<br><p class="qiz">
<span style="font-size:20px">`r "\U1F5FF"` QUIZ 2.2</span><br>
&emsp; â–  **åˆ†ä½ˆ**æ˜¯ä»€éº¼æ„æ€?<br>
&emsp; â–  æˆ‘å€‘å¦‚ä½•æª¢æŸ¥ **æ•¸å€¼** è®Šæ•¸çš„åˆ†ä½ˆ?<br>
&emsp; â–  æˆ‘å€‘å¦‚ä½•æª¢æŸ¥ **é¡åˆ¥** è®Šæ•¸çš„åˆ†ä½ˆï¼Ÿ<br>
&emsp; â–  æˆ‘å€‘å¯ä»¥ä»¥**çµ±è¨ˆé‡**æˆ–**åœ–å½¢**æª¢æŸ¥è®Šæ•¸ï¼Œå“ªç¨®æ–¹å¼æ¯”è¼ƒå¥½å‘¢?<br>
&emsp; â–  ...<br>
&emsp; â–  ä»¥çµ±è¨ˆé‡æª¢æŸ¥è®Šæ•¸ `appearances`<br>
&emsp; â–  ä»¥åœ–å½¢æ–¹å¼æª¢æŸ¥è®Šæ•¸ `year` <br>
&emsp; â–  ä»¥çµ±è¨ˆé‡æª¢æŸ¥è®Šæ•¸ `sex` <br>
&emsp; â–  ä»¥åœ–å½¢æ–¹å¼æª¢æŸ¥è®Šæ•¸ `eye`<br>

```{r}
# æŒ‡æ•£ä½ˆï¼ˆåœ¨ä¸€å®šçš„åœ°å€å…§ï¼‰å¯çœ‹å‡ºå¤§è‡´è³‡æ–™å½¢ç‹€ï¼Œæ˜¯ä¸€ç¨®æè¿°è®Šæ•¸çš„æ–¹å¼

#æª¢æŸ¥æ•¸å€¼(é€£çºŒ)è®Šæ•¸:mean(), median, max, min(),summary(),hist()
#æª¢æŸ¥é¡åˆ¥(é›¢æ•£å‹)è®Šæ•¸:table(),barplot()

# æ•¸å€¼å¤§éƒ¨åˆ†åˆ©ç”¨çµ±è¨ˆé‡ ç”¨summary() ä¹Ÿå¯ç•«ç®±å‹åœ–ç­‰
# é¡åˆ¥å¯ç•«åœ–è©®é‡‹ ç”¨tableã€barplotã€åœ“é¤…åœ–ç­‰
# æ¯ç¨®è®Šæ•¸æœ‰å€‹åˆ¥é©åˆçš„æ–¹æ³•ï¼Œæœ€å¥½å‘ˆç¾æ–¹å¼å› äººè€Œç•°(åˆ†æ•¸å€¼ã€é¡åˆ¥è€ƒæ…®)

summary(D$appearances)  #fivenum(D$appearances)

hist(D$year,xlab = 'year',main = 'year')

table(D$sex)

table(D$eye)
barplot(table(D$eye),main = 'eye')

```

</p class="qiz"><br><br><hr>


###  3. å­—ä¸²(Character) vs. å› ç´ (Factor) 

åœ¨Rè£¡é¢ï¼ŒåŸå§‹è³‡æ–™ä¹‹ä¸­çš„å­—ä¸²æ¬„ä½å¯ä»¥è¢«å„²å­˜ç‚ºå› ç´ (`factor`)æˆ–å­—ä¸²(`character`)è®Šæ•¸ï¼Œ
é€™å…©ç¨®è®Šæ•¸ä¹‹é–“å¯ä»¥ç›¸äº’è½‰æ›ã€‚ å¥½æ¯”èªªï¼Œ`align`é€™å€‹æ¬„ä½ä¸€é–‹å§‹æ˜¯è¢«ç•¶ä½œå­—ä¸²è®Šæ•¸è®€å…¥ï¼Œ 
æˆ‘å€‘å¯ä»¥ç”¨ä»¥ä¸‹çš„æŒ‡ä»¤å°‡å…¶è½‰è®Šç‚ºä¸€å€‹å…·æœ‰3å€‹ä¸åŒçš„é¡åˆ¥(<z>levels</z>)çš„å› ç´ è®Šæ•¸`f.align`

ğŸŒ» `factor()` - å°‡å­—ä¸²å‘é‡è½‰ç‚ºå› ç´ å‘é‡
```{r}
D$f.align = factor(D$align, levels=c("Good","Neutral","Bad"))
```

æœ‰éœ€è¦çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥æŒ‡å®šå› ç´ è®Šæ•¸ä¹‹ä¸­å„é¡åˆ¥(`levels`)çš„æ’åˆ—é †åº
```{r fig.height=1.8, fig.width=7.5}
par(mfrow=c(1,2), cex=0.7)  
table(D$align) %>% barplot(main="align")
table(D$f.align) %>% barplot(main="f.align")
```

æˆ‘å€‘å°‡ `eye`ä¹Ÿè½‰ç‚ºå› ç´ è®Šæ•¸
```{r}
D$eye = factor(D$eye)
```

ç¾åœ¨ï¼Œå®ƒè®Šæˆäº† 8 å€‹é¡åˆ¥(levels)çš„å› ç´ è®Šæ•¸
```{r}
str(D$eye)
```

ğŸŒ» `level(x)` åˆ—å‡ºå› ç´ è®Šæ•¸`x`ä¹‹ä¸­çš„æ‰€æœ‰é¡åˆ¥
```{r}
levels(D$eye)
```

è‹¥æˆ‘å€‘åœ¨ `factor()` ä¸­æ²’æœ‰æŒ‡å®š `levels`æ™‚ï¼Œå„é¡åˆ¥å°‡ä»¥è‹±æ–‡å­—æ¯çš„é †åºæ’åˆ—
```{r}
table(D$eye) 
```

ğŸŒ» `sort()` å°å‘é‡é€²è¡Œ(å‡å†ª)æ’åˆ—
```{r fig.height=1.8, fig.width=6}
par(mfrow=c(1,1), cex=0.7)  
table(D$eye) %>% sort(dec=T) %>% barplot
```

```{r}
summary(D)
```
ğŸŒ· åœ¨ `summary()` ä¸­ï¼Œå› ç´  (æˆ–é¡åˆ¥) è®Šæ•¸æœ€å¤šåªæœƒåˆ—å‡º 6 ç­†è³‡æ–™ï¼Œå…¶ä»–å‰‡æ­¸é¡ç‚º Other ã€‚

<p class="wwl">
<span style="font-size:20px">`r "\U1F4A1"`å­—ä¸² (Character) vs. å› ç´  (Factor)</span><br>
â–  å­—ä¸²å’Œå› ç´ éƒ½å¯ä»¥ç”¨æ–¼è¡¨ç¤ºé¡åˆ¥è®Šæ•¸ã€‚<br>
â–  é›–ç„¶å„²å­˜å’Œå‘ˆç¾çš„æ–¹å¼ä¸ç›¡ç›¸åŒï¼Œä½†å¤§å¤šæ•¸çš„æƒ…æ³å…©è€…å¯ä»¥äº¤æ›ä½¿ç”¨ã€‚<br>
â–  æŸäº›é¡åˆ¥ columns å¯èƒ½æœƒä»¥å­—ä¸²çš„å½¢å¼è¢«è®€å…¥ã€‚<br>
â–  æ‰€ä»¥ï¼Œæˆ‘å€‘æ‡‰è©²æª¢æŸ¥æ¯ä¸€ column çš„è®Šæ•¸å‹æ…‹ã€‚<br>
â–  é€šå¸¸ï¼Œæˆ‘å€‘åªéœ€ç¶­æŒå®ƒå€‘çš„åŸæ¨£ï¼Œåœ¨å¿…è¦æ™‚å°‡å®ƒå€‘è½‰æ›å‹æ…‹å³å¯ã€‚<br>
</p class="wwl"><br><br><hr>


### 4. æ’åº (Order) å’Œ ç¯©é¸ (Filter)

å¦‚æœæˆ‘å€‘æƒ³è¦åˆ—å‡ºå‡ºç¾æ¬¡æ•¸(`appearances`)æœ€å¤šçš„10å€‹æ¼«ç•«äººç‰© ... <br> 

##### 4.1 Sorting å’Œ Ordering çš„å€åˆ¥

æˆ‘å€‘å¯ä»¥ä»¥é™å†ªçš„æ–¹å¼(`decreasing=T`)å°`D$appearances`é€²è¡Œ`sort()`ä¸¦
ä½¿ç”¨`head()`å¾å‘é‡ä¸­æŒ‘é¸å‡ºæœ€å‰é¢10å€‹å€¼

```{r}
sort(D$appearances, decreasing=T) %>% head(10)
```
é€™æ¨£æˆ‘å€‘å¯ä»¥çœ‹åˆ°`D$appearances`ä¹‹ä¸­æœ€å¤§çš„10å€‹æ•¸å­—ï¼Œä½† ... ä»–å€‘æ˜¯èª°å‘¢ï¼Ÿ<br>


ğŸŒ» `sort(x)` å°`x`çš„å…§å®¹é€²è¡Œæ’åºä¸¦è¿”å›çµæœ   
ğŸŒ» `order(x)` ä¾`x`çš„å…§å®¹æ’åºå»ºç«‹ä¸€å€‹ç´¢å¼•å‘é‡ï¼Œ(ç”¨ä¾†é‡æ–°æ’åºå…¶ä»–çš„ç‰©ä»¶)
```{r}
D[order(D$appearances,decreasing=T), c("year","appearances","name")] %>% head(10)
```
å¦‚æ­¤æˆ‘å€‘å¯ä»¥æŒ‰é †åºçœ‹åˆ°å‰10åæœ€å¸¸å‡ºç¾çš„è§’è‰²çš„å‡ºç¾å¹´åˆ†(`year`)ã€å‡ºç¾æ¬¡æ•¸(`appearances`)å’Œåç¨± (`name`)ã€‚<br>


##### 4.2 æœ‰æ¢ä»¶çš„é€²è¡Œç¯©é¸ (Order)

ğŸŒ» `subset(x, æ¢ä»¶, select=y)` ä¾ç…§æ‰€çµ¦å®šçš„æ¢ä»¶ç¯©é¸rowï¼Œä¸¦ä¾æ¬„ä½åç¨±é¸æ“‡column
```{r}
d = subset(D, alive=="Deceased" & sex=="Female", select=c("year","appearances","name"))
d[order(d$appearances, decreasing=T), ] %>% head(10)
```
ä»¥ä¸Šï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°å‰10åå‡ºç¾æ¬¡æ•¸æœ€å¤šçš„å·²æ•…å¥³æ€§è§’è‰²ã€‚


<br><p class="qiz">
<span style="font-size:20px">`r "\U1F5FF"` QUIZ 4.2 </span><br>
 â–  åˆ—å‡ºå‡ºç¾æ¬¡æ•¸ç‚ºå‰ 10 åçš„é‡‘é«®ç¶ çœ¼å¥³æ€§è§’è‰²<br>
 â–  åˆ—å‡º 5 å€‹æœ€æ—©å‡ºç¾çš„ç´…é«®ã€ç´…çœ¼ç”·æ€§çš„ `year`, `publisher`, `align`, å’Œ `name`<br>
</p class="qiz">

```{r}
d = subset(D, hair=="Blond" & eye=="Green" & sex=="Female", select=c("year","name",'appearances'))
d[order(d$appearances, decreasing=T), ] %>% head(10)
```

```{r}
d = subset(D, eye=="Red" & hair=="Red" & sex=="Male", 
           select=c('year',"publisher","align","name"))
d[order(d$year, decreasing=T), ] %>% tail(10)
```

<br><hr>

### 5. è¨ˆæ•¸å’Œæ¯”ä¾‹


ğŸ“‹ ç‚ºæ¯å€‹ç¨‹å¼ç¢¼å€å¡Šå¯«ä¸‹è¨»è§£ï¼Œå°‡å…¶ä½œç‚ºè‡ªå·±çš„ç­†è¨˜æœ¬ã€‚<br><br>


##### 5.1 ä½¿ç”¨é‚è¼¯é‹ç®—å¼è¨ˆç®—æ•¸é‡å’Œæ¯”ä¾‹

ğŸŒ» ç”¨ `sum()` ä¾†è¨ˆç®—ä¸€å€‹é‚è¼¯å‘é‡è£¡é¢ `TRUE` çš„å€‹æ•¸
```{r}
#å¥½äººçš„æ•¸é‡
sum(D$align == "Good")  

```
<br>

ğŸŒ» ç”¨ `mean()` ä¾†è¨ˆç®—ä¸€å€‹é‚è¼¯å‘é‡è£¡é¢ `TRUE` çš„æ¯”ä¾‹
```{r}
#å¥½äººçš„æ¯”ä¾‹
mean(D$align == "Good")

```
<br>

##### 5.2 `table()`å’Œ`prop.table()`

ğŸŒ» `table()` åˆ—å‡ºä¸€å€‹å‘é‡è£¡å„ä¸åŒçš„å€¼å‡ºç¾çš„æ¬¡æ•¸
```{r}
#å¥½äººå£äººä¸­ç«‹çš„äººæ•¸
table(D$align)

```
<br>

ğŸŒ» `prop.table()` å°‡è¨ˆæ•¸è½‰æ›æˆæ¯”ä¾‹
```{r}
#å£äººå¥½äººä¸­ç«‹çš„æ¯”ä¾‹
table(D$align) %>% prop.table
```
<br>

å¦‚æœæˆ‘å€‘åœ¨`table()`ä¸­æ”¾å…¥å…©å€‹è®Šæ•¸ï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹å‘¢?
```{r}
#ç”¨align å’Œsex åˆ†é¡å‡ºå„äººæ•¸
table(D$f.align, D$sex)
```
<br>

æŸ¥çœ‹`prop.table`çš„ç·šä¸Šèªªæ˜(F1)ï¼Œå®ƒçš„`margin`é€™å€‹åƒæ•¸çš„ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿ
```{r}
#ç”¨align å’Œsex åˆ†é¡å‡ºå„äººæ•¸æ¯”ä¾‹ (ç¸½ç‚º1)
#align ä¸” sex çš„æ¯”ä¾‹
table(D$f.align, D$sex) %>% prop.table

#ç”¨align å’Œsex åˆ†é¡å‡ºå„äººæ•¸æ¯”ä¾‹ (å„rowåŠ ç¸½ç‚º1)
#align ä¸‹ sex çš„æ¯”ä¾‹
table(D$f.align, D$sex) %>% prop.table(1)

#ç”¨align å’Œsex åˆ†é¡å‡ºå„äººæ•¸æ¯”ä¾‹ (å„columnåŠ ç¸½ç‚º1)
#sex ä¸‹ align çš„æ¯”ä¾‹
table(D$f.align, D$sex) %>% prop.table(2)

#margin: 1 indicates rows
#        2 indicates columns
#        c(1, 2) indicates rows and columns.

```

<br>
æˆ‘å€‘ä¾†ç·´ç¿’ä¸€ä¸‹, 

+ è³‡æ–™ä¸­æœ‰å¤šå°‘å€‹å£ç”·äºº â“ 
```{r}
table(D$f.align, D$sex)
table(D$f.align, D$sex)[3,2]

```
+ å£è§’è‰²ä¹‹ä¸­æœ‰å¤šå°‘æ¯”ç‡æ˜¯å¥³çš„ â“ 
```{r}
table(D$f.align, D$sex) %>% prop.table(1)
J = table(D$f.align, D$sex) %>% prop.table(1)
J[3,1]
```
+ å¥³æ€§ä¹‹ä¸­æœ‰å¤šå°‘æ¯”ç‡æ˜¯å£äºº â“ 
```{r}
table(D$f.align, D$sex) %>% prop.table(2)
W = table(D$f.align, D$sex) %>% prop.table(2)
W[3,1]
```

<br>
<span style="font-size:40px"> ğŸ† </span>
<span style="font-size:20px; font-family:'Arial Black'">Group Competition Round 1</span>
<br><br><br>

### 6. åˆ†é¡çµ±è¨ˆèˆ‡åˆ†ç¾¤é‹ç®—

##### 6.1 åˆ†é¡çµ±è¨ˆ

è¦å›ç­”ä¸Šé¢æœ€å¾Œå…©å€‹å•é¡Œï¼Œåˆ†åˆ¥éœ€è¦åšå…©æ¬¡`table()`ï¼› å¯¦éš›ä¸Šï¼Œæˆ‘å€‘æœ‰æœ‰æ›´ç°¡ä¾¿çš„æ–¹æ³•

ğŸŒ» `tapply(value, group, fun)`ä¾æ“š`group`å°`value`åš`fun`
```{r}
tapply(D$align == "Neutral", D$sex, sum)
```
æŒ‰æ€§åˆ¥è¨ˆç®—ä¸­ç«‹çš„äººæ•¸

```{r}
tapply(D$align == "Neutral", D$sex, mean)
```
æŒ‰æ€§åˆ¥çµ±è¨ˆä¸­ç«‹çš„äººçš„æ¯”ä¾‹

<br>
æˆ‘å€‘ä¾†ç·´ç¿’ä¸€ä¸‹, 

+ æ¯ç¨®é ­é«®é¡è‰²ä¸­å¥³æ€§çš„æ¯”ä¾‹åˆ†åˆ¥æ˜¯å¤šå°‘ â“ 
```{r}
table(D$hair,D$sex) %>% prop.table(1)
tapply(D$sex=='Female', D$hair, mean)
```
+ å¥³æ€§ä¹‹ä¸­ï¼Œæ¯ç¨®é ­é«®é¡è‰²å„æœ‰å¤šå°‘äºº â“ 
```{r}

table(D$hair,D$sex)
tapply(D$sex=='Female', D$hair, sum)
```

<br>
<span style="font-size:40px"> ğŸ† </span>
<span style="font-size:20px; font-family:'Arial Black'">Group Competition Round 2</span>
<br><br><br>

##### 6.2 é †åºçµ±è¨ˆ

å•†å‹™ä¸­å¸¸æœ‰ä¸€äº›ä¸é€£çºŒä½†æœ‰æ¬¡åºçš„è®Šæ•¸ï¼Œåƒæ˜¯å¹´ä»£(`decade`)
```{r}
D$decade = (D$year - 1900) %/% 10
table(D$decade)
```

æˆ‘å€‘å¯ä»¥ä¾decadeç®—å‡ºä¸­æ€§è§’è‰²çš„æ¯”ä¾‹
```{r}
v = tapply(D$align == "Neutral", D$decade, mean) %>% round(3); v
```
å¦‚æœæŠŠé€™äº›æ•¸æ“šç¹ªè£½ç‚ºåœ–å½¢ï¼Œå°‡æ›´å®¹æ˜“è§€å¯Ÿå‡ºè¶¨å‹¢ã€‚<br>


ğŸŒ» `plot(x, y, type)` ä»¥ä¸åŒçš„æ–¹å¼ç¹ªè£½xå’Œyæ–¹å‘çš„æ•¸æ“š

+ `type="p"` æ•£é»åœ–ï¼ˆé è¨­å€¼ï¼‰
+ `type="l"` ç·šå½¢åœ–
+ `type="b"` å¸¶æ¨™è¨˜çš„ç·šåœ–
+ æœ‰é—œæ›´å¤šç·šå‹å’Œåƒæ•¸ï¼Œè«‹åƒè¦‹ç·šä¸Šèªªæ˜ï¼ˆ`F1`ï¼‰

```{r fig.height=4, fig.width=6.5}
# ç¹ªè£½åœ–å½¢åºåˆ—ä»¥æŸ¥çœ‹è¶¨å‹¢
par(mfcol=c(2,2), mar=c(3,3,2,1), cex=0.7)
v %>% barplot()               # ç›´æ¢åœ–
plot(names(v), v)             # æ•£é»åœ–
plot(names(v), v, type='l')   # ç·šå½¢åœ–
plot(names(v), v, type='b', ylim=c(0,0.25)) # å¸¶æ¨™è¨˜çš„å¾é›¶é–‹å§‹çš„ç·šåœ–
```

ä»¥ä¸Šå“ªä»¥ç¨®æ–¹å¼æ¯”è¼ƒå®¹æ˜“çœ‹è¦‹æ­£ç¢ºçš„è¶¨å‹¢å‘¢ï¼Ÿ ANS:ç·šå½¢åœ–

<br>

##### 6.3 æŒ‰åˆ†é¡æ’åˆ—çš„åºåˆ—

`tapply(value, group, function)`å¯ä»¥ä¸€æ¬¡æ¥å—å¤šå€‹åˆ†çµ„è®Šæ•¸ï¼Œå¦‚
```{r}
v = tapply(D$align=="Bad", list(D$sex, D$decade), mean) %>% round(3); v
```

ğŸŒ» `lines()`åœ¨ç¾æœ‰ç¹ªåœ–ä¸­æ·»åŠ ä¸€æ¢ç·šã€‚ä¾‹å¦‚ï¼Œæˆ‘å€‘å¯ä»¥æ¯”è¼ƒä¸åŒæ€§åˆ¥çš„å£è§’è‰²æ¯”ä¾‹çš„è¶¨å‹¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚
```{r fig.height=2.5, fig.width=4}
par(mfrow=c(1,1), mar=c(3,3,2,1), cex=0.7)
plot(colnames(v),  v[1,], type="l", ylim=c(0,0.6), col="red", lwd=2,
     main = "æŒ‰æ€§åˆ¥åŠƒåˆ†çš„å£è§’è‰²æ¯”ä¾‹")                     # æ·»åŠ æ¨™é¡Œ
lines(colnames(v), v[2,], col="blue", lwd=2)              # æ·»åŠ ç¬¬äºŒæ¢ç·š
abline(h=seq(0,0.6,0.1), v=seq(3,10,1), col='lightgray')  # æ·»åŠ æ ¼ç·š


```

ç¢ºå®šå‰ä¸‰ç¨®é ­é«®é¡è‰²...
```{r}
h3 = table(D$hair) %>% sort %>% tail(3) %>% names; h3
```

çœ‹çœ‹å‰ä¸‰ç¨®é ­é«®é¡è‰²çš„æ¯”ä¾‹å¦‚ä½•éš¨æ™‚é–“è®ŠåŒ–ã€‚
```{r fig.height=3, fig.width=4}
par(mfrow=c(1,1), mar=c(3,3,2,1), cex=0.7)

v = tapply(D$hair=="Black", D$decade, mean)
plot(names(v),v,type='l',lwd=2,col="black",ylim=c(0,0.45),
     main="å‰ä¸‰ç¨®é ­é«®é¡è‰²çš„æ¯”ä¾‹éš¨æ™‚é–“çš„è®ŠåŒ–")
 
v = tapply(D$hair=="Brown", D$decade, mean)
lines(names(v),v,type='l',lwd=2,col="brown")

v = tapply(D$hair=="Blond", D$decade, mean)
lines(names(v),v,type='l',lwd=2,col="gold")

abline(h=seq(0,0.5,0.1), v=seq(3,10,1), col='lightgray') 
```


<br><p class="qiz">
<span style="font-size:20px">`r "\U1F5FF"` QUIZ 6.3 </span><br>
ç¾åœ¨è¼ªåˆ°ä½ äº†ã€‚è«‹è£½ä½œåœ–è¡¨ä»¥... <br>
 â–  æª¢æŸ¥å‰ä¸‰ç¨®çœ¼ç›é¡è‰²çš„æ¯”ä¾‹è¶¨å‹¢<br>
 â–  ä¾æ“š`æ¼«ç•«å…¬å¸`è·Ÿ`æ€§åˆ¥`å»æ¯”è¼ƒ`å­˜æ´»æ©Ÿç‡`çš„è¶¨å‹¢<br>
</p class="qiz"><br>

```{r echo=F, results='hide'}
e3 = table(D$eye) %>% sort %>% tail(3) %>% names; e3
```

```{r fig.height=3, fig.width=4}
par(mfrow=c(1,1), mar=c(3,3,2,1), cex=0.7)

v = tapply(D$eye=="Blue", D$decade, mean)
plot(names(v),v,type='l',lwd=2,col="blue",ylim=c(0,0.6),
     main="Fractions of the Top3 Eye Colors by Decades")

v = tapply(D$eye=="Brown", D$decade, mean)
lines(names(v),v,type='l',lwd=2,col="brown")

v = tapply(D$eye=="Green", D$decade, mean)
lines(names(v),v,type='l',lwd=2,col="green")

abline(h=seq(0,0.5,0.1), v=seq(3,10,1), col='lightgray')

#è—æœ‰ä¸‹é™çš„è¶¨å‹¢ï¼Œæ£•å’Œç¶ æ•´é«”ç®—ç·©æ…¢æˆé•·ï¼Œä¸éé‚„æ˜¯è—æ£•æ¯”ä¾‹ä½”å¤§å®—

```
<br> 

```{r echo=F}

#paste0:å»æ‰æ‰€æœ‰åˆ†éš”ç¬¦è™Ÿ
D$pub_sex = paste0(D$publisher, ".", D$sex)
mx = tapply(D$alive=="Living", list(D$decade, D$pub_sex), mean)
mx

```

```{r  fig.height=3, fig.width=5.5}
par(mfrow=c(1,1), mar=c(3,3,2,1), cex=0.6)

cols = c("orange","green","magenta","blue")
ltys=c(1,1,3,3)

matplot(mx[-1,],type='l',lwd=2,col=cols, xaxt="n", ylim=c(0.55,0.91), lty=ltys,
        main = "Ratios of living characters by publisher and sex")

axis(1,at=1:8, labels=4:11)

abline(h=seq(0.6,0.9,0.1), v=1:8, col='lightgray', lty=3)

legend('bottom',colnames(mx),col=cols,lwd=2,horiz=T,bty='n',lty=ltys)

#legend:åœ–ä¾‹
#matplot:ç”¨çŸ©é™£çš„åˆ—ç•«åœ–
#xaxt='n':ä½¿Xè»¸æ¶ˆå¤±(ä¸ç„¶ä¸‹æ¨™æœƒé‡ç–Š)

#dc.femaleã€dc.maleæ•´é«”è€Œè¨€å­˜æ´»ç‡ä¸Šå‡
#mar.femaleã€mar.maleæ•´é«”è€Œè¨€ç®—å…ˆä¸‹é™å†å›å‡æŒå¹³
#æ•´é«”å­˜æ´»è¶¨å‹¢åœ¨å¾ŒæœŸéƒ½æœ‰æ˜é¡¯ä¸Šå‡

```

<br><br><hr>
