---
title: "è³‡æ–™æ¡ˆä¾‹ï¼šè€å¿ å¯¦å™´æ³‰"
output: 
  flexdashboard::flex_dashboard:
    css: data/style.css
    social: menu
    source_code: embed 
    logo: data/nsysu48.png
    favicon: data/nsysu48.png
    orientation: rows
runtime: shiny
---

```{r}
options(shiny.usecairo = FALSE)
if(!require(shiny)) install.packages("shiny")
if(!require(shinyWidgets)) install.packages("shinyWidgets")
if(!require(flexdashboard)) install.packages("flexdashboard")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(dplyr)) install.packages("dplyr")
if(!require(plotly)) install.packages("plotly")
if(!require(pacman)) install.packages("pacman")
D = faithful$eruptions
```

**æ•…äº‹** {data-icon="fa-binoculars"}
=====================================

Row {data-height=250}
-------------------------------------
### â³  **è€å¿ å¯¦å™´æ³‰** {data-width=75%}
<iframe width="100%" height="100%"  frameborder="0" src="https://www.youtube.com/embed/4mZY7uxb7Gc?start=6"  allowfullscreen></iframe>

### ğŸ  **æ•…äº‹** {data-width=25%}
<div style="height:75%">
1870å¹´9æœˆ18æ—¥ä¸‹åˆï¼Œæ²ƒä»€å¸ƒæ©-è˜­ç¦å¾·-å¤šæ©æ¢éšªåœ˜å¾å…‹åœå‹’ç€‘å¸ƒæ²¿ç«æ´æ²³é€²å…¥ä¸Šé–“æ­‡æ³‰ç›†åœ°ã€‚ä»–å€‘ç¬¬ä¸€å€‹çœ‹åˆ°çš„é–“æ­‡æ³‰å°±æ˜¯è€å¿ å¯¦ã€‚åœ¨ç´æ’’å°¼çˆ¾Â·çš®ç‰¹Â·è˜­ç¦å¾·1871å¹´å‡ºç‰ˆçš„æ¢éšªè¨˜éŒ„ä¸­ï¼Œä»–å¯«é“ï¼šâ€œ ... åœ¨ç¬¬äºŒå¤©æ—…é€”çš„ä¸‹åˆä¸‰é»å·¦å³ï¼Œæˆ‘å€‘é€²å…¥äº†é€™å€‹ç›†åœ°ã€çœ‹åˆ°äº†æ¸…æ™°çš„é™½å…‰ï¼Œæœ€ä»¤æˆ‘å€‘é©šå¥‡çš„æ˜¯åœ¨ä¸é è™•ä¸€å€‹ä¹¾æ·¨ã€å¯†é›†è€Œé–ƒé–ƒç™¼å…‰çš„æ°´æŸ±å™´å‘äº†ä¸€ç™¾äºŒåäº”è‹±å°ºé«˜ç©ºã€‚ã€Œé–“æ­‡æ³‰ï¼é–“æ­‡æ³‰ï¼ã€æˆ‘å€‘çš„ä¸€å€‹åŒä¼´å«é“ï¼Œè¸¢æ‰“è‘—èº«ä¸‹å€¦æ€ çš„é¦¬ï¼Œæˆ‘å€‘èšé›†åˆ°äº†é€™å¥‡å¢ƒå››å‘¨ã€‚é€™çµ•å°æ˜¯ä¸€å€‹å®Œç¾çš„é–“æ­‡æ³‰ã€‚æ°´æ±½ç©¿éå­”ç©´å½¢æˆä¸€å€‹ä¸è¦å‰‡çš„æ©¢åœ“ï¼Œç›´å¾‘ä¸‰é»ä¸ƒè‹±å°ºï¼Œå…¶ä¸­æ˜¯å¸¶è‘—å„ç¨®æ²‰ç©ç‰©çš„å°æ°´ç ã€‚é€™å€‹é–“æ­‡æ³‰é«˜å‡ºå®ƒæ‰€åœ¨å¹³åŸä¸‰åè‹±å°ºï¼Œå™´ç™¼å£åˆé«˜å‡ºäº”æˆ–å…­è‹±å°ºã€‚åœ¨æˆ‘å€‘å‘†åœ¨é‚£è£¡çš„æ™‚å€™ï¼Œå®ƒæœ‰è¦å¾‹åœ°å™´ç™¼äº†ä¹æ¬¡ï¼Œæ²¸æ°´å™´ç™¼çš„é«˜åº¦å¾ä¹åè‡³ä¸€ç™¾äºŒåäº”è‹±å°ºä¸ç­‰ï¼Œæ¯æ¬¡æŒçºŒç´„åäº”è‡³äºŒååˆ†é˜ã€‚æˆ‘å€‘æŠŠå®ƒå‘½åä½œã€Œè€å¿ å¯¦ã€â€ - Nathaniel P. Langford, 1871
</div>

<div style="height:25%">
<p><img src="data/cm_nsysu.png" alt="CM.NSYSU"  height="90" align="center"> <br>
[å¤§æ•¸æ“šé‹ç®—å¹³å°ç¶²ç«™](https://bap2.cm.nsysu.edu.tw)<br>
<span style="font-size:11px;">åœ‹ç«‹ä¸­å±±å¤§å­¸ ç®¡ç†å­¸é™¢</span></p>
</div>


è³‡æ–™ {data-orientation=columns data-icon="fa-table"}
=====================================
Column {data-width=180}
-------------------------------------
### `data(faithful)`
<div style="font-size:90%; height:100%; overflow-y:auto;">
```{r}
renderTable({ faithful })
```
</div>

Column {data-width=270}
-------------------------------------
### ğŸŒ» **Data** {data-height=25%}
é€™å€‹å…§å»ºè³‡æ–™é›†ç´€éŒ„äº†272æ¬¡è€å¿ å¯¦é–“æ­‡æ³‰çš„å™´ç™¼æ™‚é–“å’Œç­‰å¾…æ™‚é–“ï¼›å¾ä»¥ä¸Šé€™ä¸€äº›ç°¡å–®çš„çµ±è¨ˆé‡ï¼Œæˆ‘å€‘å¤§è‡´ä¸Šå¯ä»¥çŸ¥é“æ•¸æ“šåˆ†å¸ƒçš„ç¯„åœï¼›

### ğŸŒ» **Statistics** : `summary(faithful)` {data-height=35%}
```{r}
summary(faithful)
```

### ğŸŒ» **Chart** {data-height=20%}
æˆ‘å€‘å¯ä»¥ç”¨åœ–è¡¨å¹«åŠ©æˆ‘å€‘é€²ä¸€æ­¥äº†è§£æ•¸æ“šçš„åˆ†ä½ˆæƒ…æ³ï¼› 

### ğŸŒ» **Model** {data-height=20%}
ä½†æ˜¯åœ–è¡¨ä¸¦ä¸èƒ½å¹«æˆ‘å€‘åšæ•¸å€¼æˆ–æ©Ÿç‡çš„ä¼°è¨ˆå’Œé æ¸¬ï¼Œæƒ³è¦ç”¨æ•¸å€¼çš„æ–¹æ³•å¹«åŠ©æˆ‘å€‘åšæ±ºç­–ï¼Œæˆ‘å€‘éœ€è¦ä½¿ç”¨æ¨¡å‹ã€‚   .     

Column 
-------------------------------------
### ğŸŒ» **Scatter Plot** {data-height=85%}
```{r}
mutate(faithful, type = ifelse(eruptions > 3, "Long", "Short")) %>% 
  ggplot(aes(waiting, eruptions, col=type)) +
    geom_point(alpha=0.5) +
    geom_smooth(method='lm', se=T) +                       
    geom_smooth(method='lm', se=F, col="gray", lty=2) +
    labs(x="Waiting Time",y="Eruption Time",col="",
         title="The Eruption Events") + 
    theme_bw() -> p
ggplotly(p) %>%  layout(legend = list(x = 0.05, y = 0.95))

#se=T:é¡¯ç¤ºå¹³ç©©çš„ç½®ä¿¡å€é–“                                  # geom_smooth:ç¬¬ä¸€äºŒæ¢ç·šé †åº?
```


æ¨¡å‹é ä¼° {data-orientation=rows data-icon="fa-cogs"}
=====================================

Row {data-height=75%}
-------------------------------------

### ğŸ“Š **æ•¸å€¼åˆ†ä½ˆæ¨¡å‹** {data-width=70%}
```{r}
txt = "A model is a mathematical representation of a variable.\nA distribution function is a model that describes how the value of a variable varies."

renderPlot({
  par(mar=c(4,4,2,1))
  plot(0,0,xlim=c(1.5,5.25),ylim=c(0,1.1),xlab="å™´ç™¼æ™‚é–“(åˆ†é˜)", 
       ylab="æ©Ÿç‡å¯†åº¦", main="å™´ç™¼æ™‚é–“åˆ†ä½ˆ")
  abline(h=1, col='gray', lwd=0.5, lty=2)
  text(3.4, 1.13, txt, pos=1, col="navyblue", cex=1.2)

  bx = seq(min(D), max(D), length.out=input$W)
  adj = (bx[2] - bx[1])/2
  DEN = density(D, adjust = input$B)
  PDF = approxfun(DEN$x, DEN$y, yleft=0, yright=0)

  if(input$rug) rug(D)
  if(input$hist) hist(
    D,freq=F,col="#B3FFFF",border="white",
    ylim=c(0,1.1),add=T,breaks=bx)
  if(input$pdf) lines(DEN, col='gold', lwd=3)
  
  if(input$cdf.r) plot(ecdf(D), cex=0, verticals=T, add=T, lwd=2, col='darkgray')
  if(input$cdf.h) plot(
    stepfun(bx - adj, c(0, sapply(bx, function(b) mean(D <= b)))),
    cex=0, col='#33CC337F', lwd=3, add=T)
  if(input$cdf.d) {
    x = seq(1,6,0.1)
    abline(v=input$R, col='gold', lwd=0.5)
    lines(x, sapply(x, function(i) 
      integrate(PDF, -Inf, i)$value), col='red', lwd=3, lty=2) 
    x=c(input$R)
    y=c(integrate(PDF, -Inf, x[1])$value, integrate(PDF, -Inf, x[2])$value)
    points(x, y, col="orange", pch=16, cex=2)
    text(x, y, round(y,3), pos=3, cex=1.2)
    }

  x = seq(input$R[1], input$R[2], length=100)
  polygon(c(x, input$R[2], input$R[1]),  c(PDF(x), 0, 0), 
          col="#FF99003F", border=NA)
  abline(h=0, col='gray', lwd=0.5)

  })
```

### â± **ä¼°è¨ˆæ©Ÿç‡** {data-width=30%}
```{r}
chooseSliderSkin("Modern")

renderGauge({
  DEN = density(D, adjust = input$B)
  PDF = approxfun(DEN$x, DEN$y, yleft=0, yright=0)
  PROB = integrate(PDF, input$R[1], input$R[2])$value
  gauge(round(100*PROB,1), min = 0, max = 100, symbol = '%', gaugeSectors(
    success = c(41, 100), warning = c(21, 40), danger = c(0, 20)) )
  })
sliderInput("R", "Time Period", 1.4, 5.4, c(2.7,4.3), 0.1, width='350px')

```


Row {data-height=25%}
-------------------------------------
### ğŸš´ **æ©Ÿç‡å¯†åº¦å‡½æ•¸(PDF)** {data-width=20%}
```{r}
checkboxInput("rug", "æ•¸å€¼æ¨™è¨˜(Rugs)", T)
prettyCheckbox("hist", "ç›´æ–¹åœ–(Histogram)", F, status="info", shape="curve")
prettyCheckbox("pdf", "å¹³æ»‘å¯†åº¦å‡½æ•¸(Density Fun.)", T, status="warning", shape="curve")
```

### ğŸš´ **ç´¯è¨ˆæ©Ÿç‡å‡½æ•¸(CDF)** {data-width=20%}
```{r}
checkboxInput("cdf.r", "æ•¸å€¼æ¨™è¨˜ CDF", F)
prettyCheckbox("cdf.h", "ç›´æ–¹åœ– CDF", F, status="success", shape="curve")
prettyCheckbox("cdf.d", "å¹³æ»‘å¯†åº¦å‡½æ•¸ CDF", T, status="danger", shape="curve")
```

### ğŸš´ **èª¿æ•´æ¨¡å‹è¤‡é›œåº¦** {data-width=30%}
```{r}
sliderInput("W", "Histogram, no. Bins", 10, 40, 20, 2, width='400px') 
sliderInput("B", "Density Func., Bandwidth", 0.3, 1.8, 1, 0.1, width='400px')
```

### ğŸ’¡ **æ“ä½œèªªæ˜**  {data-width=30%}
<span style="font-size:24px"> ğŸ¦‰ </span> : 
[Youtubeå½±ç‰‡é€£çµ](https://youtu.be/PsV0h3O0Gc4)
(ctrl + click)

<div style="height:25%">
<p><img src="data/cm_nsysu.png" alt="CM.NSYSU"  height="90" align="center"> <br>
[å¤§æ•¸æ“šé‹ç®—å¹³å°ç¶²ç«™](https://bap2.cm.nsysu.edu.tw)<br>
<span style="font-size:11px;">åœ‹ç«‹ä¸­å±±å¤§å­¸ ç®¡ç†å­¸é™¢</span></p>
</div>


å•†æ¥­æƒ…å¢ƒ {data-icon="fa-money"}
=====================================
### <span style="font-size:22px">`r "\U1F5FF"` å•†æ¥­æƒ…å¢ƒ</span> {data-height=250}
<p class="qiz">
å‡å¦‚ä½ æ˜¯é»ƒçŸ³å…¬åœ’çš„æ—…éŠç›´æ˜‡æ©Ÿå…¬å¸ï¼Œä½ çš„æ¥­å‹™éœ€è¦é ä¼°è€å¿ å¯¦ä¸‹ä¸€æ¬¡çš„å™´ç™¼æ™‚é–“ï¼Œå‡å¦‚ç¾åœ¨çš„å•†æ¥­æƒ…å¢ƒæ˜¯ï¼š<br>
ä½ å¯ä»¥èŠ±30å…ƒé¸å®šä¸€å€‹é€£çºŒ60ç§’çš„æ™‚æ®µï¼Œå¦‚æœè€å¿ å¯¦ä¸‹ä¸€æ¬¡çš„å™´ç™¼æ™‚é–“è½åœ¨ä½ æŒ‡å®šçš„å€é–“ï¼Œä½ å°±å¯ä»¥è´åˆ°100å…ƒï¼›<br>
è«‹ä½ ä½¿ç”¨é »å¯¬ç‚º0.5çš„å¹³æ»‘å¯†åº¦æ¨¡å‹ ... <br>
&emsp; â–  æ±ºå®šè¦ä¸è¦åƒåŠ é€™å€‹è³­å±€<br>
&emsp; â–  å¦‚æœä½ åƒåŠ çš„è©±ï¼Œä½ è¦æŠŠå™´ç™¼æ™‚é–“è¨­å®šåœ¨å“ªä¸€å€‹å€é–“å‘¢ï¼Ÿ<br>
&emsp; â–  ä½ è¨­åœ¨é€™å€‹å€é–“çš„è©±ï¼ŒåƒåŠ é€™å€‹è³­å±€çš„æ·¨æœŸæœ›å ±å„Ÿæ˜¯ï¼Ÿ<br>
<br>
å‡å¦‚å•†æ¥­æƒ…å¢ƒè®Šæˆï¼šå¾é›¶é–‹å§‹æŠŠæ¯10ç§’é˜è¨­ç‚ºä¸€å€‹å€é–“ï¼Œæ¯å€‹å€é–“çš„è³­é‡‘æ˜¯äº”å¡ŠéŒ¢ ...<br>
&emsp; â–  ä½ è¦æ€éº¼æŠ¼æ³¨ï¼Œæ‰èƒ½ç²å¾—æœ€é«˜çš„æœŸæœ›å ±å„Ÿå‘¢ï¼Ÿ<br>
&emsp; â–  ä½ çš„æŠ•è³‡é‡‘é¡å’ŒæœŸæœ›å ±å„Ÿå„æ˜¯å¤šå°‘ï¼Ÿ<br>
<br>
å°‡æœŸæœ›å ±å„Ÿå’ŒæŠ•è³‡é‡‘é¡çš„æ¯”å€¼ç¨±ç‚ºã€ŒæœŸæœ›æŠ•è³‡å ±é…¬ç‡ã€ ...<br>
&emsp; â–  ã€Œæœ€å¤§æœŸæœ›æŠ•è³‡å ±é…¬ç‡ã€å’Œã€Œæœ€å¤§æœŸæœ›å ±é…¬ã€çš„æŠ•è³‡ç­–ç•¥æ˜¯ä¸€æ¨£çš„å—ï¼Ÿ<br>
&emsp; â–  ä½ èªç‚ºå“ªä¸€å€‹ç­–ç•¥ç›®æ¨™æ¯”è¼ƒå¥½å‘¢ï¼Ÿ ç‚ºä»€éº¼ï¼Ÿ<br>
<br>
</p class="qiz">


ç­–ç•¥æ¨¡æ“¬ {data-orientation=columns data-icon="fa-chess-knight"}
=================================================================
Column {data-width=45%}
-------------------------------------
### ğŸŒ· <b>æ¨¡æ“¬çµæœ</b> {data-height=52%}
<div style="font-size:13px; height:98%; overflow-y:auto; font-family:'Consolas';">
```{r}
DEN = density(D, adjust=0.5)                # density function  
PDF = approxfun(DEN$x, DEN$y, yleft=0, yright=0)         # pdf
x = seq(1,6,1/6)                             # 10 second steps
cdf = sapply(x, function(i) integrate(PDF,-Inf,i)$value) # cdf
outcome = data.frame(
  start = x - 1/6, stop = x, 
  prob = cdf -lag(cdf) 
  ) %>% 
  mutate(payoff = 100*prob - 5) %>% 
  arrange(desc(payoff)) %>% 
  mutate(
    n_bets = row_number(),
    c_invest = n_bets * 5,
    c_payoff = cumsum(payoff),
    c_ROI = c_payoff/c_invest
  ) 
renderTable({ outcome })
```
</div>

### â›“ <b>æ¨¡å‹ï¼šæ©Ÿç‡å¯†åº¦å‡½æ•¸</b> {data-height=10%}
<p style="font-family:'Consolas'; font-size:11px; 
color:#00c000; background:#000000;
border-left:12px solid #cce6ff; padding:4px; padding-left:10px;">
DEN = density(D, adjust=0.5) <br>
PDF = approxfun(DEN\$x, DEN\$y, yleft=0, yright=0) <br>
x = seq(1,6,1/6) <br>
cdf = sapply(x, function(i) integrate(PDF,-Inf,i)$value)<br> 
<br>
</p>

### â›“ <b>è³‡æ–™ç®¡ç·šï¼šé ä¼°ã€æƒ…å¢ƒã€æ¨¡æ“¬</b> {data-height=38%}
<p style="font-family:'Consolas'; font-size:11px; 
color:#00c000; background:#000000;
border-left:12px solid #cce6ff; padding:4px; padding-left:10px;">
outcome = data.frame( <br>
&emsp; &emsp; start = x - 1/6, stop = x, <br> 
&emsp; &emsp; prob = cdf -lag(cdf) ) %>%  <br>
&emsp; mutate(payoff = 100 \* prob - 5) %>%  <br>
&emsp; arrange(desc(payoff)) %>%  <br>
&emsp; mutate( <br>
&emsp; &emsp; n_bets = row_number(), <br>
&emsp; &emsp; c_invest = cumsum(n_bets * 5), <br>
&emsp; &emsp; c_payoff = cumsum(payoff), <br>
&emsp; &emsp; c_ROI = c_payoff/c_invest) <br>
<br>
</p>

Column {data-width=55%}
-------------------------------------
### ğŸ² <b>ç­–ç•¥ç©ºé–“</b>  {data-height=60%}
```{r}
renderPlot({
  ggplot(outcome[1:20,], aes(c_ROI, c_payoff, color=c_invest)) + 
    geom_point(size=5) + 
    geom_text(aes(label=n_bets), color='black', nudge_y=1,size=4.5) +
    scale_color_gradientn(colors=c('seagreen','gold','gold','orange','red','darkred')) +
    labs(color="æŠ•è³‡é‡‘é¡",y="é æœŸå ±å„Ÿ",x="é æœŸæŠ•å ±ç‡")
  })
```

### {data-height=40%}

<p class="wwl">
<span style="font-size:14px">`r "\U1F36D"` <b>ç­–ç•¥ç©ºé–“ï¼š</b></span><br>
&emsp; â–  æ¯ä¸€é»æ˜¯ä¸€å€‹<z>ç­–ç•¥</z>ã€åæ¨™è»¸å‰‡æ˜¯<z>ç¸¾æ•ˆæŒ‡æ¨™</z> <br>
&emsp; â–  åœ¨<z>æ•ˆç‡å‰ç·£</z>ä¸Šé¢çš„æ‰æ˜¯<z>åˆç†ç­–ç•¥</z> <br>
</p class="wwl">

<p class="wwl">
<span style="font-size:14px">`r "\U1F36D"` <b>ç­–ç•¥é™åˆ¶èˆ‡æ¬Šè¡¡ï¼š</b></span><br>
&emsp; â–  å¦‚æœæ²’æœ‰å…¶å®ƒçš„æŠ•è³‡æ©Ÿæœƒï¼Œä¹Ÿæ²’æœ‰è³‡é‡‘çš„é™åˆ¶ï¼Œæœ€ä½³çš„ç­–ç•¥æ‡‰è©²æ˜¯ï¼Ÿ<br>
&emsp; â–  å¦‚æœä½ çš„è³‡é‡‘ä¸Šé™æ˜¯`c_invest < 40`å‘¢ï¼Ÿ<br>
&emsp; â–  å¦‚æœä½ æœ‰å¦å¤–ä¸€å€‹`ROI = 62.5%`çš„æŠ•è³‡æ©Ÿæœƒå‘¢ï¼Ÿ<br>
</p class="wwl">


å­¸ç¿’é‡é» {data-icon="fa-lightbulb"}
=====================================
Row 1 
-------------------------------------
<p class="wwl">
<span style="font-size:20px">`r "\U1F36D"` å­¸ç¿’é‡é»ï¼š</span><br>
â–  è³‡æ–™åˆ†æçš„åŸºç¤ï¼šè³‡æ–™ã€çµ±è¨ˆé‡ã€åœ–å½¢ã€æ¨¡å‹ <br>
â–  å»ºç«‹æ¨¡å‹çš„æ­¥é©Ÿï¼šæ¨¡å‹å½¢å¼ã€è¤‡é›œåº¦åƒæ•¸ <br>
â–  æ¨¡å‹æ˜¯ä¸€ç¨®å¹«åŠ©æˆ‘å€‘åœ¨ä¸ç¢ºå®šä¸‹åšæ±ºç­–çš„å·¥å…·ï¼Œæœ‰æ¨¡å‹æ‰èƒ½åšé‡åŒ–çš„é æ¸¬å’Œä¼°è¨ˆ <br>
â–  ä½†æ˜¯ï¼Œé æ¸¬ä¸¦ä¸ç­‰æ–¼æ±ºç­–ï¼Œæ¨¡å‹åšå®Œï¼Œå•†æ¥­åˆ†ææ‰å‰›é–‹å§‹è€Œå·² <br>
â–  å•†æ¥­åˆ†æçš„æ­¥é©Ÿï¼š <br>
&emsp; &emsp; â—‡ è³‡æ–™ã€æ¨¡å‹ <br>
&emsp; &emsp; â—‡ æ¢ä»¶ã€é æ¸¬ã€æ¨¡æ“¬ã€ç­–ç•¥ç›®æ¨™ <br>
&emsp; &emsp; â—‡ ç­–ç•¥ç›®æ¨™è¦–è¦ºåŒ–ã€æºé€šã€æ±ºç­– <br>
â–  Rèªè¨€å¯ä»¥ä¸²è¯ä¸Šè¿°æ­¥é©Ÿï¼Œç”¨è³‡æ–™è£é…ç·šä¾†é€²è¡Œå•†æ¥­åˆ†æ <br>
â–  æ±ºç­–æ˜¯ä¸€å€‹æºé€šçš„éç¨‹ï¼Œè¦–è¦ºåŒ–æä¾›ä¸€å€‹æºé€šçš„åŸºç¤ <br>
</p class="wwl">

Row 2 
-------------------------------------
![](data/BizAnal.jpg)

